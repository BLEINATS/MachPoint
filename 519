import fs from 'fs/promises';
import path from 'path';

const directory = '/home/project';

async function cleanup() {
  console.log('Iniciando limpeza de arquivos temporários...');
  try {
    const files = await fs.readdir(directory);
    
    // Regex to match purely numeric files OR files ending with '-updated-files'
    const filesToDelete = files.filter(file => /^\d+$|^\d+-updated-files$/.test(file));

    if (filesToDelete.length === 0) {
      console.log('Nenhum arquivo temporário para limpar.');
      return;
    }

    console.log('Arquivos a serem removidos:', filesToDelete.join(', '));

    const deletePromises = filesToDelete.map(file => {
      const filePath = path.join(directory, file);
      console.log(`Removendo ${filePath}...`);
      return fs.unlink(filePath);
    });

    await Promise.all(deletePromises);
    console.log('Limpeza concluída com sucesso!');

  } catch (err) {
    console.error('Ocorreu um erro durante a limpeza:', err);
  }
}

cleanup();
